---
title: 'Data Task'
author: ""
date: ""
output: pdf_document
header-includes:
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \fancypagestyle{plain}{\pagestyle{fancy}}
  - \usepackage{xcolor}
  - \newcommand{\magenta}[1]{\textcolor{magenta}{#1}}
  - \usepackage{float}
  - \floatplacement{figure}{H}
urlcolor: blue
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = F, message = F)
library(tidyverse)
library(janitor)
library(kableExtra)
library(gplots)
```

```{r}
rm(list= ls())
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
survey <- clean_names(read_csv("RA_21_22.csv"))
# which(is.na(survey))
```

\newcommand{\gs}{\textcolor{magenta}}

# Question 1

```{r}
survey_wealth <- survey %>%
  mutate(wealth = asset_total - debt_total) 

survey_wealth_analysis_race <- survey_wealth %>%
  group_by(year, race) %>%
  summarise(median_total_wealth = log(median(wealth))) 
# Since we only need trend, just take log to make it clear.

ggplot(data = survey_wealth_analysis_race, aes(year,median_total_wealth, color = race))+
  geom_line()+
  ggtitle("Trends In Median Total Wealth Over the Last 30 Years By Race") +
  ylab("Median Wealth (In 2016 Dollars, Log Scale.)")+
  xlab("Year") +
  scale_x_continuous(breaks = round(seq(min(survey_wealth_analysis_race$year), max(survey_wealth_analysis_race$year), by = 3),1))+
  theme_light() +
  geom_vline(xintercept= 2008, linetype = "dashed", color = 'grey') + 
  geom_vline(xintercept = 2000, linetype = "dashed", color = "grey") +
  geom_vline(xintercept = 2013, linetype = "dashed", color = "grey") +
  scale_color_manual(values = c("purple", "green", "blue", "red")) +
  geom_hline(yintercept = filter(survey_wealth_analysis_race, race == 'white' & year == 2016)[[1,3]], linetype = "dashed", color = "red") +
  geom_hline(yintercept = filter(survey_wealth_analysis_race, race == 'black' & year == 2016)[[1,3]], linetype = "dashed", color = "purple") + 
  geom_hline(yintercept = filter(survey_wealth_analysis_race, race == 'other' & year == 2016)[[1,3]], linetype = "dashed", color = "blue") + 
  geom_hline(yintercept = filter(survey_wealth_analysis_race, race == 'Hispanic' & year == 2016)[[1,3]], linetype = "dashed", color = "green") + 
  geom_text(aes(x=2008, label="Great Recession", y= 9.5), colour="grey", angle=30,size = 3) +
  geom_text(aes(x=2000, label="New Century", y= 9.5), colour="grey", angle=30,size = 3) +
  geom_text(aes(x=2013, label="Recovery", y= 9.5), colour="grey", angle=30,size = 3) +
  geom_text(aes(x=2008, label ="2008", y = min(survey_wealth_analysis_race$median_total_wealth)), colour = "grey", angle = 30, size = 3)
```

From the graph the first thing we can notice is that the race is divided into two groups, one group is `white` and `other`, another group is `hispanic` and `black`. These two groups' median total wealth are so divided that we have to add log scale to make them comparable. 

As we can see, before 2000, median wealth from `white`, `hispanic` and `black` fluctuate while median wealth in `other` race experienced a large expand before 1995, then dropped from 1995 to 1998. At the new century, the median wealth of `white`, `hispanic` and `other` kept growing until 2007 (2008 data are not available), when median wealth all four races started to decrease because of the great recession, then rebounded after 2013. We can also notice (horizontal dashed line) that except for `other`, the other three races didn't have much increase in median wealth in 2016 compared to 1989.

```{r}
survey_wealth_analysis_edu <- survey_wealth %>%
  group_by(year, education) %>%
  summarise(median_total_wealth = log(median(wealth)))

ggplot(data = survey_wealth_analysis_edu, aes(year,median_total_wealth, color = education))+
  geom_line()+
  ggtitle("Trends In Median Total Wealth Over the Last 30 Years By Education") +
  ylab("Median Wealth (In 2016 Dollars, Log Scale.)")+
  xlab("Year") +
  scale_x_continuous(breaks = round(seq(min(survey_wealth_analysis_edu$year), max(survey_wealth_analysis_edu$year), by = 3),1))+
  theme_light() +
  scale_color_manual(values = c("purple", "green", "blue")) +
  geom_hline(yintercept = filter(survey_wealth_analysis_edu, education == 'college degree' & year == 2016)[[1,3]], linetype = "dashed", color = "purple") +
  geom_hline(yintercept = filter(survey_wealth_analysis_edu, education == 'no college' & year == 2016)[[1,3]], linetype = "dashed", color = "green") + 
  geom_hline(yintercept = filter(survey_wealth_analysis_edu, education == 'some college' & year == 2016)[[1,3]], linetype = "dashed", color = "blue") + 
  geom_vline(xintercept= 2008, linetype = "dashed", color = 'grey') + 
  geom_vline(xintercept = 2013, linetype = "dashed", color = "grey") +
  geom_text(aes(x=2008, label="Great Recession", y= 10.9), colour="grey", angle=30,size = 3) +
  geom_text(aes(x=2013, label="Recovery", y= 10.9), colour="grey", angle=30,size = 3) +
  geom_text(aes(x=2008, label ="2008", y = min(survey_wealth_analysis_edu$median_total_wealth)), colour = "grey", angle = 30, size = 3)

```

The graph shows that no matter what time, people with college degree have the advantage in median wealth compared to people with some college or no college. From 1989 to 2016, the median wealth from all three levels of education experienced similar trend, significant drop in 2007 (2008), and recovery around 2013. But the thing that worth notice is that, as of 2016, compared with the median wealth in 1989, people with college degree have lost much less, and those with some or without college education have lost much more.


# Question 2

```{r}
survey_house_analysis_race <- survey_wealth %>%
  mutate(housing_wealth = asset_housing - debt_housing) %>%
  group_by(year, race) %>%
  summarise(median_housing_wealth = median(housing_wealth)) %>%
  filter(race == 'black' | race == 'white')

ggplot(data = survey_house_analysis_race, aes(year,median_housing_wealth, color = race))+
  geom_line()+
  ggtitle("Trends In Median Housing Wealth Over the Last 30 Years By Race") +
  ylab("Median Housing Wealth (In 2016 Dollars)")+
  xlab("Year") +
  scale_x_continuous(breaks = round(seq(min(survey_house_analysis_race$year), max(survey_house_analysis_race$year), by = 3),1))+
  theme_light() +
  geom_vline(xintercept= 2008, linetype = "dashed", color = 'grey') + 
  geom_vline(xintercept = 2013, linetype = "dashed", color = "grey") +
  geom_text(aes(x=2008, label="Great Recession", y= 50000), colour="grey", angle=30,size = 3) +
  geom_text(aes(x=2013, label="Recovery", y= 50000), colour="grey", angle=30,size = 3) +
  geom_text(aes(x=2008, label ="2008", y = 10000), colour = "grey", angle = 30, size = 3)
```

The figure illustrates that the median housing wealth for `white` people decreased from 1989 to 1992, continued to grow until the recession, then took a dive, and finally rebounded around 2013. The trend is pretty similar to what we have in median income. The curve for `black` people is just a straight line at 0, which means that most `black` race in this survey doesn't own a home.


# Question 3


```{r}
wealth_race <- survey %>%
  filter(age >= 25) %>% # age >= 25
  filter(asset_housing != 0) %>% # house owner.
  mutate(housing_wealth = asset_housing - debt_housing) %>%
  mutate(total_wealth = asset_total - debt_total) %>%
  mutate(nonhousing_weahlth = total_wealth - housing_wealth) %>%
  group_by(year, race) %>%
  summarise(median_housing_wealth = (median(housing_wealth)), median_nonhousing_wealth = (median(nonhousing_weahlth)),
            median_housing_wealth_log = log(median(housing_wealth)), median_nonhousing_wealth_log = log(median(nonhousing_weahlth))) %>%
  filter(race == 'black' | race == 'white')
  
ggplot()+
  geom_line(data = wealth_race, aes(year, median_housing_wealth_log, color = race))+
  labs(title = "Trends In Median Housing Wealth Over the Last 30 Years",
       subtitle = "for Homeowners Age 25 or Older By Race") +
  ylab("Median Housing Wealth (In 2016 Dollars, Log Scale.)")+
  xlab("Year") +
  scale_x_continuous(breaks = round(seq(min(wealth_race$year), max(wealth_race$year), by = 3),1))+
  theme_light() +
  geom_vline(xintercept= 2008, linetype = "dashed", color = 'grey') + 
  geom_vline(xintercept = 2013, linetype = "dashed", color = "grey") +
  geom_vline(xintercept= 1995, linetype = "dashed", color = 'grey') + 
  geom_text(aes(x=1995, label="Recovery", y= 10.9), colour="grey", angle=30,size = 3) +
  geom_text(aes(x=2008, label="Great Recession", y= 10.9), colour="grey", angle=30,size = 3) +
  geom_text(aes(x=2013, label="Recovery", y= 10.9), colour="grey", angle=30,size = 3) +
  geom_text(aes(x=2008, label ="2008", y = min(wealth_race$median_housing_wealth_log)), colour = "grey", angle = 30, size = 3)+
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5)
  )

```

When focusing on the homeowners age 25 or older, for both races, the median housing wealth declined from 1989 to 1995, started to increase from 1995 to 2007 (2008), dropped significantly in the recession, then rebounded around 2013. Different from median wealth, the median housing wealth at 2016 are higher than that in 1989 for both races.

```{r}
ggplot()+
  geom_line(data = wealth_race, aes(year, median_nonhousing_wealth_log, color = race))+
  labs( title = "Trends In Median Non-Housing Wealth Over the Last 30 Years",
        subtitle = "for Homeowners Age 25 or Older By Race") +
  ylab("Median Non-Housing Wealth (In 2016 Dollars, Log Scale.)")+
  xlab("Year") +
  scale_x_continuous(breaks = round(seq(min(wealth_race$year), max(wealth_race$year), by = 3),1))+
  theme_light() +
  geom_vline(xintercept= 2008, linetype = "dashed", color = 'grey') + 
  geom_vline(xintercept = 2013, linetype = "dashed", color = "grey") +
  geom_text(aes(x=2008, label="Great Recession", y= 10.9), colour="grey", angle=30,size = 3) +
  geom_text(aes(x=2013, label="Recovery", y= 10.9), colour="grey", angle=30,size = 3)+ 
  geom_text(aes(x=2008, label ="2008", y = min(wealth_race$median_nonhousing_wealth_log)), colour = "grey", angle = 30, size = 3) +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5)
  )
```


Unlike median housing wealth, the median non-housing wealth for both races didn't experience the decline from 1989 to 1992. Both curve generally kept climbing until 2007 (2008), but the recovery happened earlier for `white`, which was in 2010.

```{r}
loss <- wealth_race %>%
  filter(year == 2007 | year == 2010) %>%
  select(year, race, median_housing_wealth) %>%
  pivot_wider(names_from = year, values_from = median_housing_wealth) %>%
  mutate(loss_in_dollars = `2007` - `2010`) %>%
  mutate(loss_in_percent = (`2007` - `2010`)/`2007`)
kable(
  loss,
  caption = "Loss in Housing Wealth Between 2007 and 2010") %>%  kable_styling(bootstrap_options = "striped",  font_size = 8, latex_options = "HOLD_position")%>% 
    row_spec(0, bold = T, color = "black")
```


According to the table, `white` group had the largest loss in housing wealth, in both dollar and proportional terms.

# Question 4

The first factor of influence that came into my mind was education and we happen to have that part of data in the survey. So I looked into the trend of percentage of some college or college degree for different races. Here is the table.

```{r}
percent_of_some_college <- survey %>%
  group_by(year, race) %>%
  select(education) %>%
  count(education) %>%
  mutate(percent = n/sum(n)) %>%
  slice(2) %>%
  mutate(college_percent = (1 - percent)*100) %>%
  select(-education, -n, -percent) %>%
  pivot_wider(names_from = year, values_from = college_percent)

kable(
  percent_of_some_college,
  caption = "Percent of Some College or College Degree from 1989 to 2016 By Race") %>%  kable_styling(bootstrap_options = "striped",  font_size = 8, latex_options = "HOLD_position")%>% 
    row_spec(0, bold = T, color = "black")
```

The table shows that the high education rate for `black` people doubled in the past 20 years, reached 56% in 2016, and `white` have increased from 58.7% to 72.6%. But from the first graph, the gap of the total wealth between `white` and `black` didn't really change a lot, there was still a huge gap even though `black` people got significantly better education in 2016. One possible explanation could be the lag of education effect. It could take some time for those who first got their college degree in 2016 to actually get paid to work and to be reflected on wealth. So it would be beneficial if the later wealth and education data are available. 


Another important and measurable factor of influence is the neighborhood characteristics. A lot of research have shown that people that grew up in the low opportunity area (Low Income Area) would end up generating less wealth in the future. So we might want to go back to 20 years ago, look at the demographic information in a low opportunity area, and track people who had moved to a higher opportunity area, and then compare their income in 2016. Or maybe we can focus on the black communities that has different levels of opportunities (Incomes) and see how much do kids in different communities earn when they grow up. These data are relatively accessible from the  government database.



