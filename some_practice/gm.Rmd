---
title: 'Task'
author: ""
date: ""
output: pdf_document
header-includes:
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \fancypagestyle{plain}{\pagestyle{fancy}}
  - \usepackage{xcolor}
  - \newcommand{\magenta}[1]{\textcolor{magenta}{#1}}
  - \usepackage{float}
  - \floatplacement{figure}{H}
urlcolor: blue
editor_options: 
  chunk_output_type: console
---
## R Markdown


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, fig.width = 8, fig.height = 6, warning = F, message = F)
#R language.

rm(list = ls())
pacman::p_load(tidyverse, #data cleaning
               janitor, # for clean_names
               reshape2, # for melt 
               msm,# for delta method
               readxl,# read_excel
               stargazer, # regression table making 
               scales, # percent 
               kableExtra, # table making 
               data.table,# sometimes useful
               lubridate, # ymd
               Hmisc, # graphing
               usmap, # US map
               chron, # for time
               zoo) # rollapply
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
ht <- read_csv("test_data.csv") %>% mutate(survivors = ifelse(victims == 0, 0, 1))
```

## Part 1 

_Summarize the data and create a summary statistics table summarizing key variables in the sample, among households with trafficking survivors, and households without trafficking survivors. Note any potential data quality issues or missingness or other issues you notice._

\begin{table}[htbp]\centering
\def\sym#1{\ifmmode^{#1}\else\(^{#1}\)\fi}
\caption{Descriptive Statistics}
\begin{tabular}{l*{3}{c}}
\hline\hline
                    &\multicolumn{1}{c}{with survivors}&\multicolumn{1}{c}{without survivors}&\multicolumn{1}{c}{Combined}\\
                    &     mean(sd)&    mean(sd)&     mean(sd)\\
\hline
monthly per person household income&       94.89&      148.83&      146.95\\
                    &    (154.72)&    (226.22)&    (224.32)\\
literacy of household head&        0.81&        0.90&        0.89\\
                    &      (0.39)&      (0.31)&      (0.31)\\
age of household head&       40.18&       39.36&       39.39\\
                    &     (10.51)&     (12.72)&     (12.64)\\
years of education for household head&        3.96&        4.08&        4.07\\
                    &      (2.08)&      (2.12)&      (2.12)\\
whether the household head is a migrant&        0.58&        0.60&        0.60\\
                    &      (0.49)&      (0.49)&      (0.49)\\
whether the household head is a foreigner&        0.00&        0.00&        0.00\\
                    &      (0.04)&      (0.02)&      (0.02)\\
whether there are any children in the household&        0.69&        0.58&        0.59\\
                    &      (0.46)&      (0.49)&      (0.49)\\
children under the age of 13 in the housheold&        0.54&        0.45&        0.46\\
                    &      (0.50)&      (0.50)&      (0.50)\\
number of adults in household&        1.00&        1.00&        1.00\\
                    &      (0.00)&      (0.00)&      (0.00)\\
number of male adults in household&        0.91&        0.43&        0.45\\
                    &      (0.29)&      (0.49)&      (0.50)\\
whether any household member survived human trafficking&        0.42&        0.18&        0.19\\
                    &      (0.49)&      (0.39)&      (0.39)\\
sex of the survivor &        1.15&            &            \\
                    &      (0.36)&            &            \\
age of the survivor &       40.47&            &            \\
                    &     (10.62)&            &            \\
years of education for survivor&        3.84&            &            \\
                    &      (1.97)&            &            \\
whether survivor has been homeless in the past&        0.00&            &            \\
                    &      (0.05)&            &            \\
\hline
Observations        &        1379&       38064&       39443\\
\hline\hline
\end{tabular}
\end{table}

This table Latex is generated by STATA.

Some Variables are excluded since the meanings of the indicators are unknown. Here in this table, I grouped variable victims that equal to 1,2,3,4 into indicator _households with trafficking survivors_.

## Part 2
_Make a figure of your choice that shows the relationship between average monthly income and trafficking status_

```{r}
q2 <- ht%>%group_by(survivors) %>% summarise(avg_income = mean(avg_income, na.rm = T))
q2$survivors <- c("without survivors", "with survivors")
ggplot(data = q2, aes(as.character(survivors), avg_income))+
  geom_bar(stat = "identity") + 
  theme_light() +
  labs(title = ("The relationship between average monthly income and trafficking status")) +
  xlab("trafficking status") +
  ylab("average monthly income")
```

## Part 3

What share of families (overall, with trafficking survivors, and without trafficking survivors) ever receive the social safety net program? What share receive the social safety net program in each year? Do trafficking survivors tend to receive the program benefits before or after being trafficked?

```{r, echo = T}
q3 <- ht %>%
  mutate(the_sum = select(., starts_with("PBF")) %>% rowSums(na.rm = T)) %>%
  mutate(ever_received = ifelse(abs(the_sum) > 1, 1, 0)) %>%
  mutate(count_each_month = apply(.,1,function(x) sum(abs(x) > 1, na.rm = T))) %>%
  mutate(receive_each_month = ifelse(count_each_month == 96, 1, 0)) %>%
  mutate(count_2012 = apply(select(., starts_with("PBF_2012")),1, function(x) sum(abs(x) > 1, na.rm = T))) %>%
  mutate(count_2013 = apply(select(., starts_with("PBF_2013")),1, function(x) sum(abs(x) > 1, na.rm = T))) %>%
  mutate(count_2014 = apply(select(., starts_with("PBF_2014")),1, function(x) sum(abs(x) > 1, na.rm = T))) %>%
  mutate(count_2015 = apply(select(., starts_with("PBF_2015")),1, function(x) sum(abs(x) > 1, na.rm = T))) %>%
  mutate(count_2016 = apply(select(., starts_with("PBF_2016")),1, function(x) sum(abs(x) > 1, na.rm = T))) %>%
  mutate(count_2017 = apply(select(., starts_with("PBF_2017")),1, function(x) sum(abs(x) > 1, na.rm = T))) %>%
  mutate(count_2018 = apply(select(., starts_with("PBF_2018")),1, function(x) sum(abs(x) > 1, na.rm = T))) %>%
  mutate(count_2019 = apply(select(., starts_with("PBF_2019")),1, function(x) sum(abs(x) > 1, na.rm = T))) %>%
  mutate(count_each_year = apply(select(., starts_with("count_201")), 1, function(x) sum(abs(x) > 1, na.rm = T))) %>%
  mutate(receive_each_year = ifelse(count_each_year == 8, 1, 0))
```

First, for each row, I sum up all `PBF` columns. If the absolute value of the sum is greater than 1, we can consider the households have received aid at least once. Then, I count how many months of aid that household received, recorded as variable `count_each_month`. And it turns out the household receiving the most aid received 91 months aid. Next, I check if the household received aid in each year, the variables are recorded as `count_201X`. 

```{r, echo = T}
mean(q3$ever_received)
```

77.39 % of families ever receive the social safety net program. 

```{r, echo = T}
mean(q3$receive_each_year)
```

0.7 % of families receive the social safety net program in each year.
